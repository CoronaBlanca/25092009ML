-- DESOFUSCADOR PARA DELTA EXECUTOR
-- =================================

-- ⚙️ CONFIGURACIÓN
local WEBHOOK_URL = "https://discordapp.com/api/webhooks/1428150779838988299/dCT_aUK_Xdufmurz8t7cd5qtjmKljVYJ5UB2c-UvhkB-OsaJ64VGsXI-XRwR9wlZ_JKT" -- Pon tu webhook de Discord
local GITHUB_RAW_URL = "https://raw.githubusercontent.com/CoronaBlanca/2198832473482/refs/heads/main/dxsxfxscxtxr%20By%20Shxryx"

-- 📊 Captura
local captured_code = {}

print("🔍 Desofuscador Delta iniciado...")

-- 🪝 HOOK DE LOADSTRING (Delta usa loadstring estándar)
local old_loadstring = loadstring
loadstring = function(code, ...)
    print("✅ ¡Código interceptado! Tamaño:", #code, "bytes")
    table.insert(captured_code, code)
    return old_loadstring(code, ...)
end

-- 📤 ENVIAR A DISCORD (Delta usa request)
local function send_to_discord(content)
    print("📤 Enviando a Discord...")
    
    -- Limitar tamaño (Discord máximo ~2000 caracteres)
    local preview = content
    if #content > 3900 then
        preview = content:sub(1, 3900) .. "\n\n... (código muy largo, ver archivo)"
    end
    
    local payload = game:GetService("HttpService"):JSONEncode({
        username = "Delta Deobfuscator",
        embeds = {{
            title = "🔓 Código Desofuscado",
            description = "```lua\n" .. preview .. "\n```",
            color = 5814783,
            footer = {
                text = "Delta Executor • " .. os.date("%H:%M:%S")
            }
        }}
    })
    
    -- Delta Executor usa 'request'
    local success, response = pcall(function()
        return request({
            Url = WEBHOOK_URL,
            Method = "POST",
            Headers = {
                ["Content-Type"] = "application/json"
            },
            Body = payload
        })
    end)
    
    if success and response.StatusCode == 204 then
        print("✅ Enviado a Discord correctamente")
        return true
    else
        warn("❌ Error enviando:", response and response.StatusCode or "desconocido")
        return false
    end
end

-- 💾 GUARDAR ARCHIVO
local function save_file(content)
    local filename = "deobfuscated_" .. os.time() .. ".lua"
    
    if writefile then
        writefile(filename, content)
        print("💾 Guardado en workspace:", filename)
        return true
    else
        warn("⚠️ writefile no disponible en Delta")
        return false
    end
end

-- 🚀 DESCARGAR CÓDIGO
print("📥 Descargando desde GitHub...")

local success_download, downloaded_code = pcall(function()
    return game:HttpGet(GITHUB_RAW_URL, true)
end)

if not success_download then
    warn("❌ Error descargando:", downloaded_code)
    warn("💡 Verifica que el link sea correcto y público")
    return
end

print("✅ Descargado:", #downloaded_code, "bytes")

-- ⚡ EJECUTAR
print("⚡ Ejecutando código ofuscado...")

local success_exec, error_msg = pcall(function()
    loadstring(downloaded_code)()
end)

if not success_exec then
    warn("⚠️ Error al ejecutar:", error_msg)
    print("💡 Esto es normal si el código necesita un contexto específico")
end

-- ⏳ ESPERAR CAPTURA
wait(2)

-- 📋 PROCESAR RESULTADOS
print("\n" .. string.rep("=", 50))
print("📊 RESULTADOS:")
print(string.rep("=", 50))

local final_output = ""

if #captured_code > 0 then
    print("🎉 ¡ÉXITO! Se capturaron", #captured_code, "código(s)")
    
    for i, code in ipairs(captured_code) do
        final_output = final_output .. "-- ========== CÓDIGO #" .. i .. " ==========\n"
        final_output = final_output .. "-- Tamaño: " .. #code .. " caracteres\n"
        final_output = final_output .. "-- Timestamp: " .. os.date() .. "\n\n"
        final_output = final_output .. code .. "\n\n"
    end
    
    print("📝 Código total capturado:", #final_output, "caracteres")
else
    print("⚠️ No se capturó código con loadstring")
    print("💡 El script podría:")
    print("   1. Ya estar desofuscado")
    print("   2. No usar loadstring()")
    print("   3. Usar otro método de ejecución")
    
    final_output = "-- NO SE CAPTURÓ CÓDIGO DINÁMICO\n"
    final_output = final_output .. "-- Código original descargado:\n\n"
    final_output = final_output .. downloaded_code
end

-- 📤 ENVIAR Y GUARDAR
print("\n📤 Enviando resultados...")

local sent = send_to_discord(final_output)
local saved = save_file(final_output)

-- 🏁 RESUMEN FINAL
print("\n" .. string.rep("=", 50))
print("🏁 PROCESO COMPLETADO")
print(string.rep("=", 50))
print("✉️  Webhook:", sent and "✅ Enviado" or "❌ Falló")
print("💾 Archivo:", saved and "✅ Guardado" or "❌ No disponible")
print(string.rep("=", 50))

if sent then
    print("✅ ¡Revisa tu canal de Discord!")
elseif saved then
    print("💡 Revisa la carpeta workspace de Delta")
else
    print("📋 Código capturado (cópialo manualmente):")
    print(final_output:sub(1, 500) .. "...")
end
